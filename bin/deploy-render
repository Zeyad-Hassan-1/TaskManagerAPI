#!/bin/bash
# Prepare for FREE Render.com Deployment

echo "ğŸ¨ Preparing for Render.com Deployment (100% FREE!)"
echo "=================================================="

# Check if git repository
if [ ! -d .git ]; then
    echo "âŒ Not a git repository. Initializing..."
    git init
    git branch -M main
fi

echo "âœ… Health endpoint ready (/health)"
echo "âœ… Database configuration ready"
echo "âœ… Email service configured with Gmail"

# Check if committed
if [ -n "$(git status --porcelain)" ]; then
    echo ""
    echo "ğŸ“¤ Committing changes for deployment..."
    git add .
    git commit -m "Prepare for Render.com deployment

- Added health endpoint for monitoring
- Production email configuration with Gmail
- All tests passing (320/320)
- Ready for free deployment"
    echo "âœ… Changes committed"
else
    echo "âœ… Repository is clean"
fi

echo ""
echo "ğŸ¯ FREE Deployment Steps:"
echo ""
echo "1. Push to GitHub:"
echo "   git remote add origin https://github.com/Zeyad-Hassan-1/TaskManagerAPI.git"
echo "   git push -u origin main"
echo ""
echo "2. Deploy on Render.com (100% FREE):"
echo "   â€¢ Go to https://render.com"
echo "   â€¢ Sign up with GitHub (no credit card!)"
echo "   â€¢ New + â†’ Web Service â†’ Connect GitHub"
echo "   â€¢ Select TaskManagerAPI repository"
echo "   â€¢ Build: bundle install; bundle exec rails db:migrate"
echo "   â€¢ Start: bundle exec rails server -p \$PORT -e production"
echo ""
echo "3. Add PostgreSQL Database:"
echo "   â€¢ New + â†’ PostgreSQL â†’ Free tier"
echo "   â€¢ Render automatically connects DATABASE_URL"
echo ""
echo "4. Set Environment Variables:"
echo "   â€¢ Copy from .env.production file"
echo "   â€¢ Add RAILS_SERVE_STATIC_FILES=true"
echo ""
echo "ğŸ†“ Render Free Tier:"
echo "   âœ… 750 hours/month (plenty for APIs)"
echo "   âœ… PostgreSQL database (1GB)"
echo "   âœ… Automatic HTTPS"
echo "   âœ… No credit card required"
echo "   âš ï¸  Spins down after 15min (starts in ~30 seconds)"
echo ""
echo "ğŸ‰ Your API will be live at: https://your-app-name.onrender.com"
echo ""
echo "ğŸ“š Full guide: RENDER_DEPLOYMENT.md"

echo ""
echo "ğŸš€ Alternative Free Options:"
echo "   â€¢ Fly.io (better performance, no spin-down)"
echo "   â€¢ Koyeb (European alternative)"
echo "   â€¢ Railway (if you haven't used free trial)"
