#!/bin/bash
# Prepare for FREE Render.com Deployment

echo "🎨 Preparing for Render.com Deployment (100% FREE!)"
echo "=================================================="

# Check if git repository
if [ ! -d .git ]; then
    echo "❌ Not a git repository. Initializing..."
    git init
    git branch -M main
fi

echo "✅ Health endpoint ready (/health)"
echo "✅ Database configuration ready"
echo "✅ Email service configured with Gmail"

# Check if committed
if [ -n "$(git status --porcelain)" ]; then
    echo ""
    echo "📤 Committing changes for deployment..."
    git add .
    git commit -m "Prepare for Render.com deployment

- Added health endpoint for monitoring
- Production email configuration with Gmail
- All tests passing (320/320)
- Ready for free deployment"
    echo "✅ Changes committed"
else
    echo "✅ Repository is clean"
fi

echo ""
echo "🎯 FREE Deployment Steps:"
echo ""
echo "1. Push to GitHub:"
echo "   git remote add origin https://github.com/Zeyad-Hassan-1/TaskManagerAPI.git"
echo "   git push -u origin main"
echo ""
echo "2. Deploy on Render.com (100% FREE):"
echo "   • Go to https://render.com"
echo "   • Sign up with GitHub (no credit card!)"
echo "   • New + → Web Service → Connect GitHub"
echo "   • Select TaskManagerAPI repository"
echo "   • Build: bundle install; bundle exec rails db:migrate"
echo "   • Start: bundle exec rails server -p \$PORT -e production"
echo ""
echo "3. Add PostgreSQL Database:"
echo "   • New + → PostgreSQL → Free tier"
echo "   • Render automatically connects DATABASE_URL"
echo ""
echo "4. Set Environment Variables:"
echo "   • Copy from .env.production file"
echo "   • Add RAILS_SERVE_STATIC_FILES=true"
echo ""
echo "🆓 Render Free Tier:"
echo "   ✅ 750 hours/month (plenty for APIs)"
echo "   ✅ PostgreSQL database (1GB)"
echo "   ✅ Automatic HTTPS"
echo "   ✅ No credit card required"
echo "   ⚠️  Spins down after 15min (starts in ~30 seconds)"
echo ""
echo "🎉 Your API will be live at: https://your-app-name.onrender.com"
echo ""
echo "📚 Full guide: RENDER_DEPLOYMENT.md"

echo ""
echo "🚀 Alternative Free Options:"
echo "   • Fly.io (better performance, no spin-down)"
echo "   • Koyeb (European alternative)"
echo "   • Railway (if you haven't used free trial)"
